<div>
  <div>
    <button
      type="button"
      [disabled]="filtroTipo === 'TODOS'"
      (click)="filtroTipo = 'TODOS'; resetPage()"
    >
      Todos
    </button>
    <button
      type="button"
      [disabled]="filtroTipo === 'RECEITA'"
      (click)="filtroTipo = 'RECEITA'; resetPage()"
    >
      Receitas
    </button>
    <button
      type="button"
      [disabled]="filtroTipo === 'DESPESA'"
      (click)="filtroTipo = 'DESPESA'; resetPage()"
    >
      Despesas
    </button>
  </div>

  <div>
    <select [(ngModel)]="filtroCategoriaId" (ngModelChange)="resetPage()">
      <option value="">Todas as categorias</option>
      <option *ngFor="let cat of categorias" [value]="cat.id">
        {{ cat.nome }}
      </option>
    </select>
  </div>

  <div>
    <input
      type="date"
      [(ngModel)]="filtroDataInicio"
      (ngModelChange)="resetPage()"
    />
    <input
      type="date"
      [(ngModel)]="filtroDataFim"
      (ngModelChange)="resetPage()"
    />
  </div>

  <div *ngIf="loading">Carregando...</div>

  <div *ngIf="!loading && filteredTransacoes.length === 0">
    Nenhuma transação encontrada.
  </div>

  <div *ngIf="!loading && filteredTransacoes.length > 0">
    <div *ngFor="let t of pagedTransacoes">
      <div>
        <div>{{ t.data | date : "dd/MM/yyyy" }}</div>
        <div>
          {{ t.descricao || (t.tipo === "RECEITA" ? "Receita" : "Despesa") }}
        </div>
        <div>{{ t.categoriaNome }}</div>
      </div>
      <div>
        <span>{{
          t.valor | currency : "BRL" : "symbol" : "1.2-2" : "pt"
        }}</span>
        <button type="button" (click)="openEdit(t)">Editar</button>
        <button type="button" (click)="openDelete(t)">Excluir</button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && filteredTransacoes.length > 0">
    <button
      type="button"
      [disabled]="currentPage === 1"
      (click)="currentPage = currentPage - 1"
    >
      Anterior
    </button>
    <span>Página {{ currentPage }} de {{ totalPages }}</span>
    <button
      type="button"
      [disabled]="currentPage >= totalPages"
      (click)="currentPage = currentPage + 1"
    >
      Próxima
    </button>
  </div>

  <app-add-entry-modal
    [open]="isEntryModalOpen"
    [mode]="entryModalMode"
    [initialTransacao]="editingTransacao"
    (close)="closeEntryModal()"
    (confirm)="handleEntryConfirm($event)"
  ></app-add-entry-modal>

  <app-confirm-modal
    [open]="isConfirmDeleteOpen"
    [title]="'Excluir transação?'"
    [description]="'Essa ação não poderá ser desfeita.'"
    [confirmLabel]="'Excluir'"
    [cancelLabel]="'Cancelar'"
    [confirming]="confirmingDelete"
    (confirm)="confirmDelete()"
    (close)="isConfirmDeleteOpen = false"
  ></app-confirm-modal>
</div>
