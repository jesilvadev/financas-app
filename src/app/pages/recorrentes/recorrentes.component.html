<div class="p-6 font-inter flex flex-col h-full">
  <!-- Header fixo com voltar -->
  <div
    class="-mx-6 px-6 pt-6 pb-4 sticky top-0 z-10 bg-secondary backdrop-blur"
  >
    <div class="flex items-center justify-center relative">
      <button
        type="button"
        class="absolute left-0 px-1 py-1 rounded-full transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40"
        routerLink="/"
        aria-label="Voltar"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="#6B54EC"
        >
          <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
        </svg>
      </button>
      <h1 class="text-center font-semibold text-primary">
        Transações recorrentes
      </h1>
    </div>
  </div>

  <!-- Conteúdo rolável -->
  <div class="flex-1 overflow-y-auto">
    <!-- Ação para abrir modal -->
    <section class="max-w-md mx-auto mt-4 mb-4">
      <button
        type="button"
        class="h-[50px] w-full items-center justify-center rounded-xl bg-primary px-6 text-sm font-medium text-white transition hover:bg-primary/90 active:scale-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40"
        (click)="abrirNovoRecorrente()"
      >
        Nova transação recorrente
      </button>
    </section>

    <!-- Listagem -->
    <section class="space-y-6 max-w-md mx-auto mb-6">
      <!-- Mensagem de erro geral -->
      <div
        *ngIf="errorMessage"
        class="text-sm text-error bg-error/10 rounded-lg px-3 py-2"
      >
        {{ errorMessage }}
      </div>

      <!-- Receitas recorrentes -->
      <div>
        <h3 class="text-sm font-semibold text-description mb-2">
          Ganhos recorrentes
        </h3>
        <div *ngIf="loading" class="text-xs text-description">
          Carregando transações recorrentes...
        </div>
        <div
          *ngIf="!loading && recorrentesReceita.length === 0"
          class="text-xs text-description"
        >
          Nenhum ganho recorrente cadastrado.
        </div>
        <div class="space-y-2 mt-1">
          <div
            *ngFor="let r of recorrentesReceita"
            class="flex items-center justify-between rounded-xl bg-white px-4 py-3 shadow-sm border border-black/5"
          >
            <div class="flex flex-col gap-0.5">
              <span class="text-sm font-semibold text-gray-900">
                {{ r.categoriaNome }}
              </span>
              <span class="text-xs text-description">
                Todo dia {{ r.diaRecorrencia }} ·
                {{ r.valor | currency : "BRL" : "symbol" : "1.2-2" : "pt" }}
              </span>
              <span *ngIf="r.descricao" class="text-[11px] text-description">
                {{ r.descricao }}
              </span>
            </div>
            <div class="flex flex-col items-end gap-1">
              <div class="flex gap-2">
                <button
                  type="button"
                  class="text-xs text-primary font-semibold"
                  (click)="abrirEdicaoRecorrente(r)"
                >
                  Editar
                </button>
                <button
                  type="button"
                  class="text-xs text-error font-semibold"
                  (click)="solicitarExclusao(r)"
                >
                  Excluir
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Despesas recorrentes -->
      <div>
        <h3 class="text-sm font-semibold text-description mb-2">
          Gastos recorrentes
        </h3>
        <div *ngIf="loading" class="text-xs text-description">
          Carregando transações recorrentes...
        </div>
        <div
          *ngIf="!loading && recorrentesDespesa.length === 0"
          class="text-xs text-description"
        >
          Nenhum gasto recorrente cadastrado.
        </div>
        <div class="space-y-2 mt-1">
          <div
            *ngFor="let r of recorrentesDespesa"
            class="flex items-center justify-between rounded-xl bg-white px-4 py-3 shadow-sm border border-black/5"
          >
            <div class="flex flex-col gap-0.5">
              <span class="text-sm font-semibold text-gray-900">
                {{ r.categoriaNome }}
              </span>
              <span class="text-xs text-description">
                Todo dia {{ r.diaRecorrencia }} ·
                {{ r.valor | currency : "BRL" : "symbol" : "1.2-2" : "pt" }}
              </span>
              <span *ngIf="r.descricao" class="text-[11px] text-description">
                {{ r.descricao }}
              </span>
            </div>
            <div class="flex flex-col items-end gap-1">
              <div class="flex gap-2">
                <button
                  type="button"
                  class="text-xs text-primary font-semibold"
                  (click)="abrirEdicaoRecorrente(r)"
                >
                  Editar
                </button>
                <button
                  type="button"
                  class="text-xs text-error font-semibold"
                  (click)="solicitarExclusao(r)"
                >
                  Excluir
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal confirmar exclusão -->
    <app-confirm-modal
      [open]="isDeleteModalOpen"
      [title]="'Excluir recorrência'"
      [description]="
        recorrenteParaExcluir
          ? 'Tem certeza que deseja excluir a recorrência da categoria ' +
            recorrenteParaExcluir.categoriaNome +
            '?'
          : ''
      "
      [confirmLabel]="'Sim, excluir'"
      [cancelLabel]="'Cancelar'"
      [confirming]="deleting"
      (close)="closeDeleteModal()"
      (confirm)="confirmarExclusao()"
    ></app-confirm-modal>

    <!-- Modal de criar/editar recorrente -->
    <app-recurring-entry-modal
      [open]="isRecurringModalOpen"
      [mode]="modalMode"
      [initialRecorrente]="editingRecorrenteModal"
      (close)="fecharModalRecorrente()"
      (confirm)="handleModalConfirm($event)"
    ></app-recurring-entry-modal>
  </div>
</div>
