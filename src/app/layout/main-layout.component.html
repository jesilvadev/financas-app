<div class="min-h-svh bg-layer text-black flex flex-col">
  <!-- HEADER -->
  <header
    *ngIf="showHeader"
    class="sticky top-0 bg-primary text-white px-5 pt-14 pb-20 overflow-hidden z-0"
  >
    <div class="mx-auto max-w-md relative z-10">
      <!-- Linha usuário + ações -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div
            class="h-10 w-10 rounded-full ring-2 ring-white/40 bg-white/15 flex items-center justify-center text-white font-semibold select-none"
          >
            <span>{{ userInitial }}</span>
          </div>
          <div class="flex flex-col">
            <span class="text-sm font-light text-white/80">Olá,</span>
            <span class="text-xl font-semibold truncate max-w-[180px]">
              {{ userName || "Usuário" }}
            </span>
          </div>
        </div>

        <!-- Ícone de notificação -->
        <button
          type="button"
          class="notification-btn relative inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/20 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/40"
          [class.notification-btn--active]="hasActiveAlert"
          [ngClass]="
            hasActiveAlert ? 'bg-white text-primary' : 'bg-white/10 text-white'
          "
          aria-label="Notificações"
          (click)="navigateToNotifications()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          </svg>
          <!-- Badge de notificações não vistas -->
          <span
            *ngIf="unreadNotificationsCount > 0"
            class="absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full bg-red-500 text-white text-[10px] font-bold border-2 border-white"
            [attr.aria-label]="
              unreadNotificationsCount + ' notificações não vistas'
            "
          >
            {{
              unreadNotificationsCount > 99 ? "99+" : unreadNotificationsCount
            }}
          </span>
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN (card flutuando) -->
  <main
    class="flex-1 bg-white relative"
    [ngClass]="{
      'rounded-t-3xl': showHeader,
      '-mt-10': showHeader,
      'md:-mt-12': showHeader
    }"
  >
    <div class="mx-auto max-w-md pb-24">
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- BOTTOM NAV + FAB -->
  <nav
    *ngIf="showBottomNav"
    class="fixed inset-x-0 bottom-0 z-50"
    style="padding-bottom: env(safe-area-inset-bottom)"
    role="tablist"
    aria-label="Navegação principal"
  >
    <div class="relative mx-auto max-w-md">
      <div
        class="h-16 bg-secondary pb-2 backdrop-blur flex items-center justify-around border-t border-black/5"
      >
        <!-- Home -->
        <a
          routerLink="/"
          #rlaHome="routerLinkActive"
          routerLinkActive
          [routerLinkActiveOptions]="{ exact: true }"
          class="flex flex-col items-center gap-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 rounded-lg px-3 py-2"
          [class.text-primary]="rlaHome.isActive"
          [class.text-secondary-dark]="!rlaHome.isActive"
          aria-current="page"
          aria-label="Início"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="24"
            viewBox="0 0 22 24"
            fill="none"
          >
            <path
              d="M0 24V8L10.6667 0L21.3333 8V24H13.3333V14.6667H8V24H0Z"
              fill="currentColor"
            />
          </svg>
          <span class="text-[10px] font-medium leading-none">Home</span>
        </a>

        <!-- Stats -->
        <a
          routerLink="/metas"
          #rlaMetas="routerLinkActive"
          routerLinkActive
          class="flex flex-col items-center gap-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 rounded-lg px-3 py-2"
          [class.text-primary]="rlaMetas.isActive"
          [class.text-secondary-dark]="!rlaMetas.isActive"
          aria-label="Gráficos"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 22 22"
            fill="none"
          >
            <path
              d="M16.4443 21.3333V12H21.3333V21.3333H16.4443ZM8.22233 21.3333V0H13.111V21.3333H8.22233ZM0 21.3333V6.66667H4.889V21.3333H0Z"
              fill="currentColor"
            />
          </svg>
          <span class="text-[10px] font-medium leading-none">Metas</span>
        </a>

        <!-- Espaço para FAB -->
        <div class="w-12"></div>

        <!-- Histórico -->
        <a
          routerLink="/history"
          #rlaHistory="routerLinkActive"
          routerLinkActive
          class="flex flex-col items-center gap-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 rounded-lg px-3 py-2"
          [class.text-primary]="rlaHistory.isActive"
          [class.text-secondary-dark]="!rlaHistory.isActive"
          aria-label="Histórico"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              d="M11.911 24C8.68145 24 5.91667 22.8797 3.61667 20.639C1.31667 18.3981 0.111111 15.6592 0 12.4223H2.24433C2.34811 15.0446 3.32778 17.2593 5.18333 19.0667C7.03889 20.874 9.28145 21.7777 11.911 21.7777C14.6592 21.7777 16.987 20.8166 18.8943 18.8943C20.8017 16.9721 21.7553 14.637 21.7553 11.889C21.7553 9.18522 20.7942 6.89811 18.872 5.02767C16.9498 3.15744 14.6294 2.22233 11.911 2.22233C10.3926 2.22233 8.97033 2.57044 7.64433 3.26667C6.31833 3.96289 5.17756 4.89622 4.222 6.06667H7.77767V8.289H0.466667V1H2.68867V4.4C3.83689 3.02222 5.21289 1.94444 6.81667 1.16667C8.42022 0.388889 10.1183 0 11.911 0C13.5777 0 15.1424 0.312999 16.6053 0.938999C18.0684 1.56478 19.3462 2.41656 20.4387 3.49433C21.5313 4.57211 22.3943 5.83511 23.0277 7.28333C23.661 8.73156 23.9777 10.289 23.9777 11.9557C23.9777 13.6223 23.661 15.1871 23.0277 16.65C22.3943 18.1129 21.5313 19.387 20.4387 20.4723C19.3462 21.5574 18.0684 22.4167 16.6053 23.05C15.1424 23.6833 13.5777 24 11.911 24ZM16 17.489L10.8887 12.4223V5.26667H13.111V11.511L17.5777 15.911L16 17.489Z"
              fill="currentColor"
            />
          </svg>
          <span class="text-[10px] font-medium leading-none">Histórico</span>
        </a>

        <!-- Perfil -->
        <a
          routerLink="/profile"
          #rlaProfile="routerLinkActive"
          routerLinkActive
          class="flex flex-col items-center gap-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 rounded-lg px-3 py-2"
          [class.text-primary]="rlaProfile.isActive"
          [class.text-secondary-dark]="!rlaProfile.isActive"
          aria-label="Perfil"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="21"
            viewBox="0 0 22 21"
            fill="none"
          >
            <path
              d="M10.6667 10.222C9.2 10.222 7.98144 9.73689 7.011 8.76667C6.04078 7.79622 5.55567 6.57767 5.55567 5.111C5.55567 3.64433 6.04078 2.42578 7.011 1.45533C7.98144 0.485112 9.2 0 10.6667 0C12.1333 0 13.3519 0.485112 14.3223 1.45533C15.2926 2.42578 15.7777 3.64433 15.7777 5.111C15.7777 6.57767 15.2926 7.79622 14.3223 8.76667C13.3519 9.73689 12.1333 10.222 10.6667 10.222ZM0 20.911V17.5777C0 16.7628 0.205556 16.0498 0.616667 15.4387C1.02778 14.8276 1.563 14.3628 2.22233 14.0443C3.67411 13.3703 5.09256 12.8648 6.47767 12.5277C7.863 12.1906 9.25933 12.022 10.6667 12.022C12.074 12.022 13.4666 12.1942 14.8443 12.5387C16.2221 12.8831 17.637 13.385 19.089 14.0443C19.763 14.3628 20.3056 14.8276 20.7167 15.4387C21.1278 16.0498 21.3333 16.7628 21.3333 17.5777V20.911H0Z"
              fill="currentColor"
            />
          </svg>
          <span class="text-[10px] font-medium leading-none">Perfil</span>
        </a>
      </div>

      <!-- FAB central -->
      <div
        class="absolute -top-8 left-1/2 -translate-x-1/2 flex items-center justify-center"
      >
        <div
          class="relative h-16 w-16 flex items-center justify-center rounded-full bg-white"
        >
          <span
            class="pointer-events-none absolute inset-0 ring-4 ring-white rounded-full"
          ></span>
          <button
            aria-label="Adicionar"
            type="button"
            class="relative h-full w-full rounded-full bg-primary text-white shadow-xl flex items-center justify-center transition active:scale-95 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-primary/40"
            (click)="openAddModal()"
          >
            <span class="text-2xl leading-none">+</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <app-add-entry-modal
    [open]="isAddModalOpen"
    (close)="closeAddModal()"
    (confirm)="handleAddEntry($event)"
  ></app-add-entry-modal>
</div>
